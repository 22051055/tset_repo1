<!DOCTYPE html>
<html>
<head>
    <title>戸隠to飯綱林道</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <style>
        #map, #graph {
            width: 100%;
            height: 50vh;
        }
        #slider-container {
            display: flex;
            justify-content: center;
            margin-top: 0px;
        }
        #slider {
            width: 100%;
        }
        #distances, #elevations {
            text-align: center;
            margin-top: 10px;
        }        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
</head>
<body>
    <div id="title"><a>戸隠to飯綱林道</a></div>
    <div id="map"></div>
    <div id="graph" style="touch-action: manipulation;"></div>
    <div id="slider-container">
        <input type="range" id="slider" min="0" max="100" value="0" />
    </div>
    <div id="distances">
        <p>水平距離: <span id="horizontal-distance"></span> km</p>
        <p>沿面距離: <span id="surface-distance"></span> km</p>
    </div>
    <div id="elevations">
        <p>累積標高上り: <span id="total-ascent"></span> m</p>
        <p>累積標高下り: <span id="total-descent"></span> m</p>
        <p>最高標高: <span id="max-elevation"></span> m</p>
        <p>最低標高: <span id="min-elevation"></span> m</p>
    </div>
    <div>
        <a href="/uploads/processed_3_1Togakushi_to_Iidsunerindo.gpx_viewer.html" download>GPXファイルをダウンロード</a>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
　　<script>
        $(document).ready(function() {
            // 地図の初期化
            var map = L.map('map').setView([36.75448, 138.0928], 14);
            L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: '&copy; <a href="https://maps.gsi.go.jp/development/ichiran.html">国土地理院</a>'
            }).addTo(map);

            // GPXトラックの表示
            var latlngs = [
                
                    [36.75448, 138.0928, 1298,],

                    [36.75446, 138.09278, 1298.7,],

                    [36.75442, 138.09291, 1300,],

                    [36.75437, 138.09295, 1300,],

                    [36.75439, 138.09299, 1300,],

                    [36.75444, 138.09301, 1300,],

                    [36.7545, 138.0931, 1300,],

                    [36.75467, 138.09342, 1302,],

                    [36.75485, 138.09371, 1304,],

                    [36.75488, 138.0938, 1304,],

                    [36.75493, 138.094, 1304,],

                    [36.75498, 138.09413, 1306,],

                    [36.75503, 138.09423, 1306,],

                    [36.75516, 138.09434, 1307,],

                    [36.75534, 138.09448, 1307,],

                    [36.75549, 138.09464, 1307,],

                    [36.75558, 138.09483, 1307,],

                    [36.75566, 138.09506, 1307,],

                    [36.75566, 138.09522, 1308,],

                    [36.75583, 138.09543, 1309,],

                    [36.7561, 138.09586, 1314,],

                    [36.75625, 138.09612, 1311,],

                    [36.75619, 138.09626, 1310,],

                    [36.75618, 138.09633, 1310,],

                    [36.75613, 138.09638, 1311,],

                    [36.75612, 138.09641, 1311,],

                    [36.75611, 138.09648, 1311,],

                    [36.75619, 138.09659, 1311,],

                    [36.75645, 138.09663, 1313,],

                    [36.75671, 138.09659, 1312,],

                    [36.75695, 138.09674, 1314,],

                    [36.75703, 138.09698, 1314,],

                    [36.75714, 138.09737, 1312,],

                    [36.75725, 138.09762, 1311,],

                    [36.75736, 138.09773, 1312,],

                    [36.75751, 138.09781, 1311,],

                    [36.75763, 138.09794, 1311,],

                    [36.75778, 138.09804, 1311,],

                    [36.75793, 138.09819, 1312,],

                    [36.75798, 138.09846, 1315,],

                    [36.75798, 138.0987, 1315,],

                    [36.75795, 138.09892, 1313,],

                    [36.75796, 138.09907, 1313,],

                    [36.75806, 138.09915, 1313,],

                    [36.75813, 138.0992, 1315,],

                    [36.75839, 138.09925, 1318,],

                    [36.75859, 138.0992, 1323,],

                    [36.7589, 138.09905, 1325,],

                    [36.75914, 138.09894, 1326,],

                    [36.75925, 138.09892, 1329,],

                    [36.75931, 138.09892, 1330,],

                    [36.75936, 138.09896, 1330,],

                    [36.75936, 138.0991, 1332,],

                    [36.7591, 138.09953, 1340,],

                    [36.75893, 138.0998, 1345,],

                    [36.75889, 138.09988, 1347,],

                    [36.75889, 138.10004, 1348,],

                    [36.75896, 138.1002, 1347,],

                    [36.75913, 138.10052, 1345,],

                    [36.75937, 138.10088, 1349,],

                    [36.75945, 138.10105, 1351,],

                    [36.75955, 138.1013, 1355,],

                    [36.75962, 138.10142, 1357,],

                    [36.7597, 138.10159, 1358,],

                    [36.7597, 138.10197, 1360,],

                    [36.75966, 138.10228, 1361,],

                    [36.75968, 138.10248, 1362,],

                    [36.75982, 138.10262, 1365,],

                    [36.75984, 138.10272, 1366,],

                    [36.75981, 138.10285, 1367,],

                    [36.75979, 138.10291, 1368,],

                    [36.75968, 138.10313, 1370,],

                    [36.7596, 138.1034, 1364,],

                    [36.75953, 138.10356, 1362,],

                    [36.75949, 138.10369, 1363,],

                    [36.75938, 138.10398, 1354,],

                    [36.75925, 138.1042, 1353,],

                    [36.75913, 138.10443, 1353,],

                    [36.75912, 138.10461, 1351,],

                    [36.75909, 138.10482, 1351,],

                    [36.75926, 138.10509, 1345,],

                    [36.75955, 138.10541, 1346,],

                    [36.7598, 138.10559, 1347,],

                    [36.75987, 138.10571, 1350,],

                    [36.75997, 138.10576, 1351,],

                    [36.76002, 138.106, 1352,],

                    [36.75999, 138.10629, 1355,],

                    [36.76003, 138.10645, 1355,],

                    [36.76027, 138.10663, 1354,],

                    [36.76042, 138.10681, 1356,],

                    [36.76046, 138.10703, 1360,],

                    [36.76054, 138.10775, 1366,],

                    [36.76056, 138.10812, 1369,],

                    [36.76057, 138.10832, 1369,],

                    [36.76059, 138.10843, 1368,],

                    [36.76063, 138.1085, 1368,],

                    [36.76017, 138.10934, 1387,],

                    [36.75976, 138.11005, 1398,],

                    [36.75973, 138.11011, 1397,],

                    [36.75947, 138.11032, 1411,],

                    [36.75901, 138.1107, 1420,],

                    [36.75877, 138.111, 1424,],

                    [36.75864, 138.11124, 1427,],

                    [36.75852, 138.11152, 1432,],

                    [36.75838, 138.11166, 1438,],

                    [36.75815, 138.11175, 1447,],

                    [36.75791, 138.11175, 1456,],

                    [36.75762, 138.11151, 1463,],

                    [36.75761, 138.11108, 1470,],

                    [36.75764, 138.11075, 1476,],

                    [36.75761, 138.1104, 1481,],

                    [36.75765, 138.11013, 1485,],

                    [36.75773, 138.10989, 1482,],

                    [36.75769, 138.10972, 1484,],

                    [36.75764, 138.1095, 1485,],

                    [36.75743, 138.10914, 1488,],

                    [36.7573, 138.10885, 1486,],

                    [36.75728, 138.10883, 1486,],

                    [36.75724, 138.10876, 1486,],

                    [36.75717, 138.10877, 1488,],

                    [36.75701, 138.10887, 1493,],

                    [36.75681, 138.10908, 1502,],

                    [36.7566, 138.10929, 1510,],

                    [36.75645, 138.10944, 1517,],

                    [36.75622, 138.10969, 1526,],

                    [36.75594, 138.10988, 1540,],

                    [36.7558, 138.10996, 1546,],

                    [36.7555, 138.11012, 1559,],

                    [36.75525, 138.11032, 1569,],

                    [36.75513, 138.11042, 1573,],

                    [36.75492, 138.11063, 1581,],

                    [36.75471, 138.11096, 1586,],

                    [36.75451, 138.1114, 1591,],

                    [36.75445, 138.11197, 1595,],

                    [36.75444, 138.11231, 1594,],

                    [36.75444, 138.11253, 1594,],

                    [36.75441, 138.11262, 1594,],

                    [36.75411, 138.11285, 1589,],

                    [36.75376, 138.11308, 1580,],

                    [36.75354, 138.11327, 1575,],

                    [36.7534, 138.11333, 1573,],

                    [36.75336, 138.11333, 1572,],

                    [36.75336, 138.11318, 1572,],

                    [36.75333, 138.11315, 1572,],

                    [36.7529, 138.11316, 1573,],

                    [36.75265, 138.11316, 1576,],

                    [36.75257, 138.1135, 1576,],

                    [36.75244, 138.11371, 1576,],

                    [36.7522, 138.11401, 1577,],

                    [36.75174, 138.11417, 1582,],

                    [36.7513, 138.11443, 1584,],

                    [36.75118, 138.1145, 1584,],

                    [36.7511, 138.11458, 1584,],

                    [36.75094, 138.11465, 1586,],

                    [36.75065, 138.11466, 1589,],

                    [36.75049, 138.11469, 1594,],

                    [36.75018, 138.11481, 1601,],

                    [36.75004, 138.11481, 1603,],

                    [36.74986, 138.11473, 1604,],

                    [36.74934, 138.11549, 1617,],

                    [36.74879, 138.11634, 1634,],

                    [36.74859, 138.11668, 1642,],

                    [36.74812, 138.11729, 1661,],

                    [36.74799, 138.11771, 1668,],

                    [36.74778, 138.11803, 1676,],

                    [36.74768, 138.11833, 1684,],

                    [36.74762, 138.11845, 1687,],

                    [36.74756, 138.11859, 1691,],

                    [36.74746, 138.11912, 1700,],

                    [36.74729, 138.11977, 1715.2,],

                    [36.7471, 138.12011, 1725.9,],

                    [36.74697, 138.12029, 1731.9,],

                    [36.74687, 138.12042, 1737.6,],

                    [36.74683, 138.12053, 1740.7,],

                    [36.74682, 138.1207, 1744.6,],

                    [36.74671, 138.12078, 1744.3,],

                    [36.74655, 138.12072, 1746.7,],

                    [36.74641, 138.12062, 1747.3,],

                    [36.74622, 138.12058, 1748.3,],

                    [36.74589, 138.12059, 1745.5,],

                    [36.74582, 138.12058, 1744.6,],

                    [36.74579, 138.12046, 1743.9,],

                    [36.74572, 138.12036, 1741.1,],

                    [36.74561, 138.12006, 1737,],

                    [36.7455, 138.11987, 1734.9,],

                    [36.7453, 138.11968, 1728.3,],

                    [36.74511, 138.11953, 1725.4,],

                    [36.74498, 138.11936, 1724.8,],

                    [36.74496, 138.11901, 1714,],

                    [36.74495, 138.11863, 1711,],

                    [36.74494, 138.11854, 1710,],

                    [36.74487, 138.1184, 1707,],

                    [36.74491, 138.11829, 1706,],

                    [36.74505, 138.11819, 1704,],

                    [36.74513, 138.11798, 1700,],

                    [36.74526, 138.11766, 1688,],

                    [36.74539, 138.11738, 1679,],

                    [36.74555, 138.11714, 1671,],

                    [36.74594, 138.11638, 1641,],

                    [36.74634, 138.11555, 1618,],

                    [36.74653, 138.11494, 1609,],

                    [36.74664, 138.11447, 1604,],

                    [36.74675, 138.11396, 1597,],

                    [36.74678, 138.1135, 1592,],

                    [36.7468, 138.11323, 1587,],

                    [36.74685, 138.11294, 1583,],

                    [36.74689, 138.11251, 1575,],

                    [36.74689, 138.11225, 1571,],

                    [36.74692, 138.11199, 1566,],

                    [36.74689, 138.11145, 1557,],

                    [36.74692, 138.11103, 1549,],

                    [36.74704, 138.11065, 1541,],

                    [36.74709, 138.11028, 1535,],

                    [36.74714, 138.10998, 1529,],

                    [36.74713, 138.10969, 1524,],

                    [36.74714, 138.10938, 1517,],

                    [36.7472, 138.10882, 1508,],

                    [36.74726, 138.10834, 1500,],

                    [36.74735, 138.10811, 1495,],

                    [36.74735, 138.1076, 1491,],

                    [36.74749, 138.1069, 1486,],

                    [36.74757, 138.10662, 1483,],

                    [36.7476, 138.10623, 1484,],

                    [36.74761, 138.10606, 1486,],

                    [36.74753, 138.10595, 1487,],

                    [36.74745, 138.1058, 1488,],

                    [36.74741, 138.10569, 1489,],

                    [36.74737, 138.10547, 1491,],

                    [36.74719, 138.10509, 1487,],

                    [36.74709, 138.10481, 1485,],

                    [36.74704, 138.10475, 1482,],

                    [36.747, 138.10476, 1481,],

                    [36.74692, 138.10516, 1475,],

                    [36.74687, 138.10532, 1476,],

                    [36.7468, 138.10534, 1472,],

                    [36.74672, 138.10513, 1462,],

                    [36.74659, 138.10489, 1458,],

                    [36.74648, 138.10489, 1451,],

                    [36.74641, 138.10519, 1447,],

                    [36.74632, 138.10533, 1444,],

                    [36.74623, 138.10534, 1438,],

                    [36.74616, 138.10516, 1434,],

                    [36.74614, 138.10508, 1435,],

                    [36.74607, 138.10526, 1430,],

                    [36.74605, 138.10535, 1430,],

                    [36.74588, 138.10537, 1418,],

                    [36.74574, 138.10561, 1410,],

                    [36.74565, 138.10564, 1406,],

                    [36.74562, 138.10584, 1403,],

                    [36.74553, 138.10591, 1400,],

                    [36.74538, 138.10594, 1396,],

                    [36.74523, 138.10586, 1392,],

                    [36.74514, 138.10578, 1391,],

                    [36.745, 138.10578, 1389,],

                    [36.74472, 138.10597, 1378,],

                    [36.74452, 138.10623, 1369,],

                    [36.74429, 138.10649, 1361,],

                    [36.7439, 138.10658, 1351,],

                    [36.74345, 138.10662, 1342,],

                    [36.74329, 138.10665, 1339,],

                    [36.74318, 138.10669, 1337,],

                    [36.74298, 138.10647, 1332,],

                    [36.74284, 138.10632, 1330,],

                    [36.74262, 138.10611, 1324,],

                    [36.74253, 138.10606, 1322,],

                    [36.74226, 138.10593, 1318,],

                    [36.74199, 138.10592, 1316,],

                    [36.74159, 138.1056, 1304,],

                    [36.74098, 138.1051, 1299,],

                    [36.74095, 138.1051, 1299,],

                    [36.7408, 138.1049, 1295,],

                    [36.74074, 138.10479, 1293,],

                    [36.74067, 138.10473, 1292,],

                    [36.7406, 138.10478, 1293,],

                    [36.74051, 138.10498, 1294,],

                    [36.74049, 138.10511, 1296,],

                    [36.74038, 138.10529, 1295,],

                    [36.74032, 138.10552, 1296,],

                    [36.74035, 138.10572, 1298,],

                    [36.7403, 138.10589, 1298,],

                    [36.74014, 138.10624, 1300,],

                    [36.74006, 138.10629, 1299,],

                    [36.73998, 138.10669, 1303,],

                    [36.7399, 138.10688, 1305,],

                    [36.73964, 138.10746, 1308,],

                    [36.73956, 138.10779, 1311,],

                    [36.73958, 138.10814, 1314,],

                    [36.73951, 138.10857, 1316,],

                    [36.73943, 138.10881, 1319,],

                    [36.73957, 138.10896, 1321,],

                    [36.73966, 138.1092, 1324,],

                    [36.73967, 138.10982, 1333,],

                    [36.73974, 138.1101, 1337,],

                    [36.73984, 138.1103, 1340,],

                    [36.73983, 138.11055, 1343,],

                    [36.73996, 138.11074, 1347,],

                    [36.74002, 138.11098, 1350,],

                    [36.74007, 138.11127, 1354,],

                    [36.74006, 138.11173, 1359,],

                    [36.74, 138.11219, 1364,],

                    [36.73986, 138.1125, 1365,],

                    [36.73976, 138.11283, 1367,],

                    [36.73966, 138.11325, 1370,],

                    [36.73959, 138.1136, 1375,],

                    [36.73962, 138.1142, 1377,],

                    [36.73966, 138.11468, 1379,],

                    [36.73963, 138.11499, 1383,],

                    [36.73953, 138.11525, 1387,],

                    [36.73931, 138.11552, 1394,],

                    [36.73916, 138.11564, 1398,],

                    [36.73907, 138.11571, 1403,],

                    [36.73899, 138.11573, 1405,],

                    [36.73892, 138.11573, 1407,],

                    [36.73882, 138.11565, 1407,],

                    [36.73871, 138.1154, 1410,],

                    [36.73856, 138.115, 1411,],

                    [36.73847, 138.11471, 1417,],

                    [36.73838, 138.11431, 1419,],

                    [36.73828, 138.11389, 1422,],

                    [36.73814, 138.11346, 1427,],

                    [36.73806, 138.11321, 1429,],

                    [36.73801, 138.11315, 1429,],

                    [36.73798, 138.11282, 1423,],

                    [36.73799, 138.11226, 1422,],

                    [36.73778, 138.1117, 1416,],

                    [36.73764, 138.11139, 1414,],

                    [36.73751, 138.11116, 1411,],

                    [36.73744, 138.11107, 1412,],

                    [36.73744, 138.11096, 1411,],

                    [36.7374, 138.11078, 1411,],

                    [36.7374, 138.11042, 1406,],

                    [36.73734, 138.11021, 1405,],

                    [36.73732, 138.10992, 1405,],

                    [36.73729, 138.10962, 1404,],

                    [36.73727, 138.10933, 1402,],

                    [36.7372, 138.10907, 1402,],

                    [36.73726, 138.10895, 1401,],

                    [36.73726, 138.10868, 1400,],

                    [36.73729, 138.10853, 1399,],

                    [36.73729, 138.10841, 1397,],

                    [36.7373, 138.10819, 1395,],

                    [36.73731, 138.10779, 1388,],

                    [36.73727, 138.10742, 1381,],

                    [36.73725, 138.10706, 1372,],

                    [36.73721, 138.10675, 1367,],

                    [36.73725, 138.10639, 1362,],

                    [36.73736, 138.10584, 1353,],

                    [36.7374, 138.10487, 1335,],

                    [36.73744, 138.10446, 1330,],

                    [36.73743, 138.10411, 1327,],

                    [36.73744, 138.10358, 1320,],

                    [36.73744, 138.10332, 1316,],

                    [36.73749, 138.10308, 1315,],

                    [36.73751, 138.10276, 1312,],

                    [36.73753, 138.10253, 1311,],

                    [36.73753, 138.10223, 1306,],

                    [36.73764, 138.10172, 1299,],

                    [36.73769, 138.10136, 1290,],

                    [36.73719, 138.10019, 1268,],

                    [36.73703, 138.09975, 1262,],

                    [36.73691, 138.09939, 1257,],

                    [36.73677, 138.09897, 1251,],

                    [36.73678, 138.09886, 1250,],

                    [36.73684, 138.09847, 1243,],

                    [36.73695, 138.09819, 1240,],

                    [36.73685, 138.09796, 1239,],

                    [36.73689, 138.09767, 1230,],

                    [36.73679, 138.09716, 1226,],

                    [36.73677, 138.09679, 1221,],

                    [36.73672, 138.09662, 1220,],

                    [36.7366, 138.09644, 1219,],

                    [36.73654, 138.0964, 1219,],

            ];
            var polyline = L.polyline(latlngs.map(function(latlng) { return [latlng[0], latlng[1]]; }), {color: 'blue'}).addTo(map);

            // 距離計算関数
            function calculateDistance(lat1, lon1, lat2, lon2) {
                function toRad(x) {
                    return x * Math.PI / 180;
                }
                var R = 6371; // 地球の半径 (km)
                var dLat = toRad(lat2 - lat1);
                var dLon = toRad(lon2 - lon1);
                var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }

            // ローパスフィルタによる標高データのスムージング
            function lowPassFilter(elevations, alpha) {
                var smoothed = [elevations[0]]; // 初期値は最初の標高値
                for (var i = 1; i < elevations.length; i++) {
                    var smoothedValue = alpha * elevations[i] + (1 - alpha) * smoothed[i - 1];
                    smoothed.push(smoothedValue);
                }
                return smoothed;
            }

            // 累積距離計算 (水平距離)
            var distances = [0];
            var totalDistance = 0;
            for (var i = 1; i < latlngs.length; i++) {
                var d = calculateDistance(latlngs[i-1][0], latlngs[i-1][1], latlngs[i][0], latlngs[i][1]);
                totalDistance += d;
                distances.push(totalDistance);
            }

            // 累積距離計算 (沿面距離)
            function calculateSurfaceDistance(lat1, lon1, ele1, lat2, lon2, ele2) {
                var horizontalDistance = calculateDistance(lat1, lon1, lat2, lon2);
                var verticalDistance = (ele2 - ele1) / 1000; // m to km
                return Math.sqrt(horizontalDistance * horizontalDistance + verticalDistance * verticalDistance);
            }

            var surfaceDistances = [0];
            var totalSurfaceDistance = 0;
            for (var i = 1; i < latlngs.length; i++) {
                var d = calculateSurfaceDistance(latlngs[i-1][0], latlngs[i-1][1], latlngs[i-1][2], latlngs[i][0], latlngs[i][1], latlngs[i][2]);
                totalSurfaceDistance += d;
                surfaceDistances.push(totalSurfaceDistance);
            }

            // 標高データのスムージング
            var elevations = latlngs.map(function(latlng) { return latlng[2]; });
            var alpha = 0.167; // スムージング係数 (0.0 < alpha < 1.0)
            var smoothedElevations = lowPassFilter(elevations, alpha);

            // 累積標高計算
            var totalAscent = 0;
            var totalDescent = 0;
            var maxElevation = Math.max(...smoothedElevations);
            var minElevation = Math.min(...smoothedElevations);
            for (var i = 1; i < smoothedElevations.length; i++) {
                var diff = smoothedElevations[i] - smoothedElevations[i-1];
                if (diff > 0) {
                    totalAscent += diff;
                } else {
                    totalDescent += Math.abs(diff);
                }
            }

            // 水平距離と沿面距離の表示
            document.getElementById('horizontal-distance').innerText = totalDistance.toFixed(0);
            document.getElementById('surface-distance').innerText = totalSurfaceDistance.toFixed(0);

            // 累積標高と最高・最低標高の表示
            document.getElementById('total-ascent').innerText = totalAscent.toFixed(0);
            document.getElementById('total-descent').innerText = totalDescent.toFixed(0);
            document.getElementById('max-elevation').innerText = maxElevation.toFixed(0);
            document.getElementById('min-elevation').innerText = minElevation.toFixed(0);

            // 標高グラフの初期化
            var graphDiv = document.getElementById('graph');
            Plotly.newPlot(graphDiv, [{
                x: distances,
                y: smoothedElevations,
                type: 'scatter',
                mode: 'lines'
            }], {
                xaxis: { title: '距離 (km)' },
                yaxis: { title: '標高 (m)' }
            });

            // マーカーの初期化
            var marker = L.marker([latlngs[0][0], latlngs[0][1]]).addTo(map);

            // スライダーの設定
            var slider = document.getElementById('slider');
            slider.max = latlngs.length - 1;

            // マーカーとビューを更新する共通関数
            function updateMarkerAndView(idx) {
                var latlng = latlngs[idx];
                marker.setLatLng([latlng[0], latlng[1]]);
                map.setView([latlng[0], latlng[1]], 15);
                Plotly.Fx.hover('graph', [{
                    curveNumber: 0,
                    pointNumber: idx
                }]);
            }

            slider.addEventListener('input', function() {
                var idx = slider.value;
                updateMarkerAndView(idx);
            });

            // グラフのホバーイベント
            graphDiv.on('plotly_hover', function(eventdata) {
                var idx = eventdata.points[0].pointNumber;
                slider.value = idx;
                updateMarkerAndView(idx);
            });

            // グラフのクリックイベント
            graphDiv.on('plotly_click', function(eventdata) {
                var idx = eventdata.points[0].pointNumber;
                slider.value = idx;
                updateMarkerAndView(idx);
            });

            // 初期距離表示更新
            updateMarkerAndView(0);
        });
    </script>
</body>
</html>
