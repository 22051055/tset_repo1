<!DOCTYPE html>
<html>
<head>
    <title>7/1猫坂ハイキングコース</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <style>
        #map, #graph {
            width: 100%;
            height: 50vh;
        }
        #slider-container {
            display: flex;
            justify-content: center;
            margin-top: 0px;
        }
        #slider {
            width: 100%;
        }
        #distances, #elevations {
            text-align: center;
            margin-top: 10px;
        }        
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
</head>
<body>
    <div id="title"><a>7/1猫坂ハイキングコース</a></div>
    <div id="map"></div>
    <div id="graph" style="touch-action: manipulation;"></div>
    <div id="slider-container">
        <input type="range" id="slider" min="0" max="100" value="0" />
    </div>
    <div id="distances">
        <p>水平距離: <span id="horizontal-distance"></span> km</p>
        <p>沿面距離: <span id="surface-distance"></span> km</p>
    </div>
    <div id="elevations">
        <p>累積標高上り: <span id="total-ascent"></span> m</p>
        <p>累積標高下り: <span id="total-descent"></span> m</p>
        <p>最高標高: <span id="max-elevation"></span> m</p>
        <p>最低標高: <span id="min-elevation"></span> m</p>
    </div>
    <div>
        <a href="/uploads/processed_7_1nekosakahike.gpx_viewer.html" download>GPXファイルをダウンロード</a>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
　　<script>
        $(document).ready(function() {
            // 地図の初期化
            var map = L.map('map').setView([35.7694535465753, 138.5563570261], 14);
            L.tileLayer('https://cyberjapandata.gsi.go.jp/xyz/std/{z}/{x}/{y}.png', {
                maxZoom: 18,
                attribution: '&copy; <a href="https://maps.gsi.go.jp/development/ichiran.html">国土地理院</a>'
            }).addTo(map);

            // GPXトラックの表示
            var latlngs = [
                
                    [35.7694535465753, 138.5563570261, 866.7,],

                    [35.7693012069094, 138.556292653084, 864.5,],

                    [35.7690618154163, 138.55638384819, 853.9,],

                    [35.7692794440762, 138.556694984436, 847.9,],

                    [35.7693969633049, 138.556909561157, 852.4,],

                    [35.7695667129953, 138.55706512928, 851.1,],

                    [35.7695667129953, 138.557569384575, 841.7,],

                    [35.7697843402737, 138.55782687664, 846,],

                    [35.7700019669564, 138.557982444763, 850.2,],

                    [35.7702108880116, 138.558057546616, 854,],

                    [35.7703327583737, 138.558132648468, 856.4,],

                    [35.7702239455594, 138.558282852173, 860.8,],

                    [35.7701456002408, 138.558347225189, 859.9,],

                    [35.7701368952007, 138.558459877968, 862.5,],

                    [35.770267470703, 138.55848133564, 861.6,],

                    [35.7704459235427, 138.558395504952, 862.8,],

                    [35.7706591959235, 138.558261394501, 861.9,],

                    [35.7708550578103, 138.558325767517, 863.8,],

                    [35.7710248043886, 138.558363318443, 865.8,],

                    [35.7714948699453, 138.558486700058, 869.7,],

                    [35.7717168443813, 138.558513522148, 878,],

                    [35.7719953996596, 138.55850815773, 879.4,],

                    [35.7722826587685, 138.558459877968, 877.9,],

                    [35.7726134406994, 138.558379411697, 885,],

                    [35.7729485736209, 138.557977080345, 891.5,],

                    [35.7732793527819, 138.557832241058, 882.8,],

                    [35.7735796642495, 138.557885885239, 886.5,],

                    [35.7738146898244, 138.558170199394, 884.7,],

                    [35.7740105439394, 138.558298945427, 887.7,],

                    [35.7742020452744, 138.559082150459, 901.9,],

                    [35.7742847388901, 138.559382557869, 910,],

                    [35.7744762395648, 138.559575676918, 923.5,],

                    [35.7748635917923, 138.560138940811, 935,],

                    [35.7750246253091, 138.560230135918, 938.3,],

                    [35.7749071143966, 138.559800982475, 944.9,],

                    [35.774872296315, 138.559699058533, 944.2,],

                    [35.7749288756898, 138.559629321098, 952.2,],

                    [35.7750463865701, 138.559747338295, 954.6,],

                    [35.775102965821, 138.559790253639, 957.4,],

                    [35.7751813062557, 138.559999465942, 956.8,],

                    [35.7754337360202, 138.5602247715, 944.1,],

                    [35.7759037755154, 138.560074567795, 975.7,],

                    [35.7763128817031, 138.560181856155, 953,],

                    [35.7765914208819, 138.560256958008, 956.8,],

                    [35.7768873676902, 138.560492992401, 963.9,],

                    [35.7771397920385, 138.560814857483, 966.4,],

                    [35.7772616517819, 138.561362028122, 957.7,],

                    [35.7772964688171, 138.561812639236, 960,],

                    [35.777400919831365, 138.56195211410525, 966.5,],

                    [35.7775227791746, 138.562241792679, 968.4,],

                    [35.77767075098307, 138.56235980987552, 967.2,],

                    [35.77781872251616, 138.56247782707217, 967.7,],

                    [35.77791446865555, 138.5625529289246, 968.2,],

                    [35.77801021467964, 138.56258511543277, 969.4,],

                    [35.7781494814179, 138.562670946121, 970.9,],

                    [35.778227818851, 138.5626816749573, 972.2,],

                    [35.7784280141627, 138.56281042099, 975.2,],

                    [35.77853246369038, 138.56285333633426, 976.7,],

                    [35.7786630254071, 138.562971353531, 977.1,],

                    [35.77882840327371, 138.5630035400391, 977.6,],

                    [35.7790285970731, 138.563067913055, 980,],

                    [35.77917656607908, 138.56303572654727, 982.1,],

                    [35.77926360654221, 138.5630035400391, 984.7,],

                    [35.779433, 138.562971, 987.4,],

                    [35.77949861531661, 138.56299281120303, 984.3,],

                    [35.779690103433985, 138.5630571842194, 986.8,],

                    [35.77982936722967, 138.56314301490787, 989.6,],

                    [35.7800208545504, 138.563250303268, 990.4,],

                    [35.780151413822836, 138.5634005069733, 994.3,],

                    [35.78023845321865, 138.563529253006, 999.2,],

                    [35.780273268950296, 138.56362581253055, 999.4,],

                    [35.7803429003679, 138.563765287399, 1001.2,],

                    [35.78044734737988, 138.56382966041568, 1002.1,],

                    [35.78052568254882, 138.56400132179263, 1007.3,],

                    [35.7806823526551, 138.564151525497, 1009.8,],

                    [35.78079550309546, 138.56433391571048, 1013.9,],

                    [35.7808999495128, 138.56449484825137, 1012.7,],

                    [35.780986988089126, 138.56455922126773, 1013.6,],

                    [35.7810566188816, 138.564666509628, 1016.6,],

                    [35.78125680707007, 138.56478452682498, 1019.6,],

                    [35.78138736431274, 138.56481671333316, 1022.1,],

                    [35.7816136630255, 138.564848899841, 1028.4,],

                    [35.781787738519945, 138.56494545936587, 1031.2,],

                    [35.78194440613909, 138.56495618820193, 1032.5,],

                    [35.781996628610166, 138.56503129005435, 1035.9,],

                    [35.7821358883654, 138.565106391907, 1038.4,],

                    [35.78230125900784, 138.56521368026736, 1041.5,],

                    [35.78238829604989, 138.56528878211978, 1044,],

                    [35.78254496248546, 138.56539607048038, 1046.1,],

                    [35.78271903594065, 138.56550335884097, 1048.5,],

                    [35.782823479830775, 138.5655784606934, 1050.7,],

                    [35.78293662722357, 138.5656535625458, 1052,],

                    [35.7830062563083, 138.56572866439822, 1053.7,],

                    [35.7831281070599, 138.565793037415, 1057.9,],

                    [35.783293475638196, 138.56585741043094, 1060.5,],

                    [35.78343273312154, 138.56595396995547, 1063.9,],

                    [35.783545879647136, 138.56605052948, 1065.4,],

                    [35.78364597067015, 138.5661041736605, 1067.5,],

                    [35.7837460615671, 138.566157817841, 1069.8,],

                    [35.78385267999265, 138.56622755527536, 1071,],

                    [35.783959298275185, 138.56629729270975, 1074.4,],

                    [35.784065916414725, 138.56636703014416, 1077.9,],

                    [35.78417253441125, 138.56643676757852, 1082.8,],

                    [35.784279152264794, 138.5665065050129, 1086.3,],

                    [35.78438576997529, 138.56657624244727, 1089.4,],

                    [35.78449238754279, 138.56664597988163, 1093.8,],

                    [35.7845990049673, 138.566715717316, 1099.2,],

                    [35.784691479148236, 138.56676131486927, 1102.8,],

                    [35.7847839532216, 138.56680691242252, 1110.5,],

                    [35.78487642718738, 138.56685250997577, 1117.8,],

                    [35.78496890104556, 138.56689810752903, 1126.7,],

                    [35.78506137479618, 138.56694370508228, 1128,],

                    [35.78515384843923, 138.56698930263553, 1127.8,],

                    [35.78524632197467, 138.5670349001888, 1129.7,],

                    [35.7853387954025, 138.567080497742, 1128.5,],

                    [35.7853931914863, 138.56717303395305, 1127.7,],

                    [35.78544758753287, 138.567265570164, 1127.1,],

                    [35.7855019835422, 138.567358106375, 1125.8,],

                    [35.78555637951432, 138.567450642586, 1125.2,],

                    [35.785610775449186, 138.56754317879702, 1123,],

                    [35.78566517134686, 138.567635715008, 1121.4,],

                    [35.7857195672073, 138.56772825121902, 1118.9,],

                    [35.7857739630305, 138.56782078743, 1117.1,],

                    [35.78575438053842, 138.56793075799956, 1115.9,],

                    [35.78573479804152, 138.56804072856912, 1113.3,],

                    [35.785715215539796, 138.5681506991387, 1110.6,],

                    [35.785695633033264, 138.56826066970828, 1107.9,],

                    [35.7856804021915, 138.56837600469592, 1105.8,],

                    [35.785665171346835, 138.56849133968356, 1104.4,],

                    [35.78564994049926, 138.5686066746712, 1101.5,],

                    [35.78564232507435, 138.56866434216502, 1101.1,],

                    [35.78563470964875, 138.56872200965884, 1100.3,],

                    [35.785612951285806, 138.5688051581383, 1097.2,],

                    [35.78559119291691, 138.56888830661777, 1095.6,],

                    [35.78556943454206, 138.56897145509723, 1092.2,],

                    [35.78555855535241, 138.56901302933693, 1091.5,],

                    [35.785547676161286, 138.5690546035767, 1091.1,],

                    [35.78563470964875, 138.56927990913394, 1090.4,],

                    [35.785726094708025, 138.56944620609286, 1092.6,],

                    [35.785817479662214, 138.5696125030518, 1091.1,],

                    [35.78583488630826, 138.56973588466647, 1090.6,],

                    [35.78585229295048, 138.56985926628116, 1087.6,],

                    [35.785948029414556, 138.57010602951053, 1087.3,],

                    [35.786004600907326, 138.57024013996127, 1087.8,],

                    [35.78606117235979, 138.57037425041202, 1087.1,],

                    [35.786156908572266, 138.5704439878464, 1086.7,],

                    [35.78625264466943, 138.5705137252808, 1085.2,],

                    [35.7864702262796, 138.57047080993655, 1086.3,],

                    [35.786618181434285, 138.5704064369202, 1086.9,],

                    [35.78676613631356, 138.57032060623172, 1087.6,],

                    [35.78690538771304, 138.57032060623172, 1087,],

                    [35.78703593567847, 138.57030987739566, 1086.4,],

                    [35.78716648342951, 138.5702991485596, 1088.4,],

                    [35.78731226149805, 138.5702320933343, 1086.6,],

                    [35.7874580392992, 138.570165038109, 1083.9,],

                    [35.78745368772695, 138.56991291046145, 1084,],

                    [35.78735142570971, 138.5697788000107, 1085.2,],

                    [35.7872491635609, 138.56964468956, 1085,],

                    [35.78719803243718, 138.5694850981235, 1081.8,],

                    [35.78714690128055, 138.56932550668702, 1083.3,],

                    [35.787095770091014, 138.56916591525052, 1082.2,],

                    [35.7870446388686, 138.569006323814, 1077.6,],

                    [35.78689233290473, 138.5689070820805, 1075.4,],

                    [35.786740026649, 138.568807840347, 1072.3,],

                    [35.78661382981606, 138.56865227222448, 1077.1,],

                    [35.7864876327827, 138.568496704102, 1074,],

                    [35.786435413262, 138.568298220634, 1073.5,],

                    [35.7866007749598, 138.568223118782, 1072.1,],

                    [35.786740026649, 138.568233847618, 1070.5,],

                    [35.7868488168614, 138.568153381348, 1070.3,],

                    [35.786818355617, 138.567783236504, 1069.4,],

                    [35.7868444652558, 138.567654490471, 1065.8,],

                    [35.7869140909174, 138.56752038002, 1065.8,],

                    [35.7870663968396, 138.567515015602, 1065.1,],

                    [35.7871621318413, 138.567713499069, 1063.9,],

                    [35.787318788868, 138.568019270897, 1060.5,],

                    [35.7874188751401, 138.568212389946, 1056.3,],

                    [35.787558125396, 138.568357229233, 1056.1,],

                    [35.7877408909866, 138.568378686905, 1059.5,],

                    [35.7878844922272, 138.568518161774, 1057.8,],

                    [35.7881151239798, 138.568603992462, 1055.9,],

                    [35.7883544581097, 138.568834662437, 1053.6,],

                    [35.788541573382, 138.568947315216, 1055.3,],

                    [35.7887330397163, 138.568802475929, 1051.2,],

                    [35.788793960725904, 138.56862276792498, 1049.9,],

                    [35.7888548816888, 138.568443059921, 1050.3,],

                    [35.7888940451404, 138.568185567856, 1049.4,],

                    [35.789000656660605, 138.568043410778, 1047.9,],

                    [35.7891072680378, 138.5679012537, 1046.1,],

                    [35.78924869107259, 138.56781542301147, 1043.2,],

                    [35.7893901138557, 138.567729592323, 1043.9,],

                    [35.78949890044072, 138.56760084629047, 1044.1,],

                    [35.7896076868768, 138.567472100258, 1043.6,],

                    [35.7897338789561, 138.567359447479, 1042.2,],

                    [35.7898687737158, 138.567477464676, 1042.2,],

                    [35.789818732138095, 138.56766521930703, 1039.8,],

                    [35.7897686905289, 138.567852973938, 1036.1,],

                    [35.78970777026645, 138.56801122427, 1033.7,],

                    [35.7896468499573, 138.568169474602, 1035.1,],

                    [35.78958592960146, 138.568327724934, 1034.8,],

                    [35.7895250091989, 138.568485975266, 1035.7,],

                    [35.78947061594292, 138.56862276792552, 1033.9,],

                    [35.7894162226497, 138.568759560585, 1033.7,],

                    [35.78946626448087, 138.56885880231852, 1034.4,],

                    [35.7895163062805, 138.568958044052, 1034.6,],

                    [35.7896860130185, 138.568974137306, 1032.2,],

                    [35.789814380695084, 138.5689070820805, 1034.5,],

                    [35.7899427481643, 138.568840026855, 1034,],

                    [35.790038479701266, 138.56876090168922, 1030.8,],

                    [35.79013421112289, 138.56868177652348, 1032.1,],

                    [35.79022994242922, 138.5686026513577, 1031.4,],

                    [35.7903256736202, 138.568523526192, 1028.8,],

                    [35.7904692701905, 138.568518161774, 1026.2,],

                    [35.7904692701905, 138.568705916405, 1025.3,],

                    [35.7903670120534, 138.56886550784125, 1023.2,],

                    [35.790264753784705, 138.5690250992775, 1020,],

                    [35.790162495384465, 138.56918469071374, 1017.2,],

                    [35.7900602368526, 138.56934428215, 1015.5,],

                    [35.78992751813636, 138.56951057910896, 1012.5,],

                    [35.78979479919847, 138.56967687606797, 1009.9,],

                    [35.789662080038966, 138.56984317302698, 1007.1,],

                    [35.7895293606578, 138.570009469986, 1004.5,],

                    [35.78953697571025, 138.57016369700426, 1003.7,],

                    [35.78954459076197, 138.5703179240225, 1001.7,],

                    [35.78955220581295, 138.57047215104078, 998.7,],

                    [35.7895598208632, 138.570626378059, 1007.3,],

                    [35.78957396309748, 138.57072964310626, 1000.1,],

                    [35.789588105329244, 138.5708329081535, 998.9,],

                    [35.78960224755849, 138.57093617320078, 998.1,],

                    [35.7896163897852, 138.571039438248, 994.1,],

                    [35.78965772858735, 138.57111051678675, 998.1,],

                    [35.78969906736801, 138.57118159532547, 996.9,],

                    [35.789740406127166, 138.57125267386422, 995.2,],

                    [35.7897817448648, 138.571323752403, 994.6,],

                    [35.78985136795327, 138.57140287756897, 993.5,],

                    [35.78992099098072, 138.571482002735, 992.5,],

                    [35.789990613947175, 138.571561127901, 991.8,],

                    [35.790060236852646, 138.571640253067, 990.8,],

                    [35.790129859697124, 138.57171937823298, 990.1,],

                    [35.79019948248062, 138.571798503399, 990.3,],

                    [35.790269105203116, 138.571877628565, 989.4,],

                    [35.7903387278646, 138.571956753731, 989,],

                    [35.79039121678392, 138.5720160976054, 988.5,],

                    [35.79044370566858, 138.57207544147985, 988.4,],

                    [35.79049619451857, 138.5721347853543, 989.2,],

                    [35.790548683333895, 138.57219412922876, 988.7,],

                    [35.79060117211457, 138.57225347310322, 989.6,],

                    [35.790653660860535, 138.57231281697764, 989.6,],

                    [35.79070614957185, 138.57237216085204, 989.4,],

                    [35.790758638248484, 138.57243150472652, 989.1,],

                    [35.79081112689048, 138.57249084860095, 988.1,],

                    [35.79086361549778, 138.57255019247538, 987.8,],

                    [35.79091610407042, 138.57260953634977, 988,],

                    [35.79096859260838, 138.57266888022426, 987.4,],

                    [35.79102108111171, 138.5727282240987, 987.5,],

                    [35.79107356958033, 138.5727875679731, 987.6,],

                    [35.7911260580143, 138.57284691184753, 987.3,],

                    [35.7911785464136, 138.572906255722, 987.4,],

                    [35.791237289865954, 138.57300817966453, 986.8,],

                    [35.7912960332749, 138.573110103607, 987.5,],

                    [35.79134281040287, 138.57324019074426, 986.8,],

                    [35.79138958750327, 138.5733702778815, 986.4,],

                    [35.791436364576136, 138.57350036501873, 988.2,],

                    [35.7914831416215, 138.573630452156, 986.9,],

                    [35.791544060523016, 138.57369214296327, 988,],

                    [35.79160497937779, 138.57375383377052, 987.8,],

                    [35.791665898185926, 138.57381552457778, 988,],

                    [35.7917268169473, 138.573877215385, 988,],

                    [35.79178991132954, 138.574016690254, 987.7,],

                    [35.79185300566165, 138.57415616512301, 984.1,],

                    [35.79191609994367, 138.57429563999202, 987.5,],

                    [35.7919791941756, 138.574435114861, 988.5,],

                    [35.79205751798003, 138.57444852590604, 990,],

                    [35.7921358417072, 138.574461936951, 986.1,],

                    [35.79215107131187, 138.57436537742652, 984.4,],

                    [35.7921663009136, 138.574268817902, 978.3,],

                    [35.79216847657076, 138.57402205467255, 974.9,],

                    [35.79216956439934, 138.5738986730578, 976.8,],

                    [35.7921706522279, 138.573775291443, 979.1,],

                    [35.79220546273328, 138.57365995645554, 980.9,],

                    [35.7922402732234, 138.573544621468, 982.9,],

                    [35.79234905590686, 138.57349365949648, 981.5,],

                    [35.79246654103774, 138.57341051101687, 981.2,],

                    [35.7925883772863, 138.573555350304, 982,],

                    [35.792547040008614, 138.573764562607, 985.3,],

                    [35.7925057027094, 138.57397377491, 982.4,],

                    [35.79252963483262, 138.574182987213, 983.5,],

                    [35.7925535669486, 138.574392199516, 981.8,],

                    [35.79261883631923, 138.57455581426598, 981.2,],

                    [35.7926841056362, 138.574719429016, 979.4,],

                    [35.79268410563621, 138.574891090393, 979,],

                    [35.7926841056362, 138.57506275177, 981.4,],

                    [35.792686281279195, 138.575266599655, 984,],

                    [35.7926884569221, 138.57547044754, 982.7,],

                    [35.79275155054081, 138.575604557991, 982,],

                    [35.7928146441094, 138.575738668442, 984.4,],

                    [35.79289079145303, 138.5758057236675, 985.4,],

                    [35.7929669387237, 138.575872778893, 985.4,],

                    [35.793019153952855, 138.5758352279665, 983.8,],

                    [35.7930713691477, 138.57579767704, 978.9,],

                    [35.79313011120092, 138.57565820217147, 978.9,],

                    [35.7931888532107, 138.575518727303, 981.9,],

                    [35.7933476739826, 138.575521409512, 983.8,],

                    [35.7935064944371, 138.575524091721, 980.6,],

                    [35.79360874853434, 138.5754624009135, 979.7,],

                    [35.7937110025, 138.575400710106, 979.6,],

                    [35.79385024173098, 138.57527732849152, 979.3,],

                    [35.793989480718, 138.575153946877, 977.2,],

                    [35.7940721537511, 138.57498764991803, 976.6,],

                    [35.7941548266982, 138.574821352959, 976.4,],

                    [35.79424837756091, 138.5745477676395, 980.1,],

                    [35.79429515295099, 138.57441097497974, 980.3,],

                    [35.7943419283135, 138.57427418232, 981.1,],

                    [35.79439196704291, 138.574134707451, 981.9,],

                    [35.7944420057408, 138.573995232582, 984.1,],

                    [35.794474639657246, 138.5739362239835, 984.6,],

                    [35.7945072735603, 138.573877215385, 984.3,],

                    [35.7946595649306, 138.573823571205, 983.4,],

                    [35.7947161302223, 138.574000597, 990.6,],

                    [35.794687847581486, 138.57417762279505, 989.8,],

                    [35.7946595649306, 138.57435464859, 988.6,],

                    [35.79466609169706, 138.57449948787703, 989.6,],

                    [35.794672618463, 138.574644327164, 989.6,],

                    [35.79473788609306, 138.5747382044795, 988.8,],

                    [35.7948031536695, 138.574832081795, 987.4,],

                    [35.794842314189644, 138.5747435688975, 988.7,],

                    [35.7948814746905, 138.574655056, 990,],

            ];
            var polyline = L.polyline(latlngs.map(function(latlng) { return [latlng[0], latlng[1]]; }), {color: 'blue'}).addTo(map);

            // 距離計算関数
            function calculateDistance(lat1, lon1, lat2, lon2) {
                function toRad(x) {
                    return x * Math.PI / 180;
                }
                var R = 6371; // 地球の半径 (km)
                var dLat = toRad(lat2 - lat1);
                var dLon = toRad(lon2 - lon1);
                var a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                        Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                        Math.sin(dLon / 2) * Math.sin(dLon / 2);
                var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            }

            // ローパスフィルタによる標高データのスムージング
            function lowPassFilter(elevations, alpha) {
                var smoothed = [elevations[0]]; // 初期値は最初の標高値
                for (var i = 1; i < elevations.length; i++) {
                    var smoothedValue = alpha * elevations[i] + (1 - alpha) * smoothed[i - 1];
                    smoothed.push(smoothedValue);
                }
                return smoothed;
            }

            // 累積距離計算 (水平距離)
            var distances = [0];
            var totalDistance = 0;
            for (var i = 1; i < latlngs.length; i++) {
                var d = calculateDistance(latlngs[i-1][0], latlngs[i-1][1], latlngs[i][0], latlngs[i][1]);
                totalDistance += d;
                distances.push(totalDistance);
            }

            // 累積距離計算 (沿面距離)
            function calculateSurfaceDistance(lat1, lon1, ele1, lat2, lon2, ele2) {
                var horizontalDistance = calculateDistance(lat1, lon1, lat2, lon2);
                var verticalDistance = (ele2 - ele1) / 1000; // m to km
                return Math.sqrt(horizontalDistance * horizontalDistance + verticalDistance * verticalDistance);
            }

            var surfaceDistances = [0];
            var totalSurfaceDistance = 0;
            for (var i = 1; i < latlngs.length; i++) {
                var d = calculateSurfaceDistance(latlngs[i-1][0], latlngs[i-1][1], latlngs[i-1][2], latlngs[i][0], latlngs[i][1], latlngs[i][2]);
                totalSurfaceDistance += d;
                surfaceDistances.push(totalSurfaceDistance);
            }

            // 標高データのスムージング
            var elevations = latlngs.map(function(latlng) { return latlng[2]; });
            var alpha = 0.167; // スムージング係数 (0.0 < alpha < 1.0)
            var smoothedElevations = lowPassFilter(elevations, alpha);

            // 累積標高計算
            var totalAscent = 0;
            var totalDescent = 0;
            var maxElevation = Math.max(...smoothedElevations);
            var minElevation = Math.min(...smoothedElevations);
            for (var i = 1; i < smoothedElevations.length; i++) {
                var diff = smoothedElevations[i] - smoothedElevations[i-1];
                if (diff > 0) {
                    totalAscent += diff;
                } else {
                    totalDescent += Math.abs(diff);
                }
            }

            // 水平距離と沿面距離の表示
            document.getElementById('horizontal-distance').innerText = totalDistance.toFixed(0);
            document.getElementById('surface-distance').innerText = totalSurfaceDistance.toFixed(0);

            // 累積標高と最高・最低標高の表示
            document.getElementById('total-ascent').innerText = totalAscent.toFixed(0);
            document.getElementById('total-descent').innerText = totalDescent.toFixed(0);
            document.getElementById('max-elevation').innerText = maxElevation.toFixed(0);
            document.getElementById('min-elevation').innerText = minElevation.toFixed(0);

            // 標高グラフの初期化
            var graphDiv = document.getElementById('graph');
            Plotly.newPlot(graphDiv, [{
                x: distances,
                y: smoothedElevations,
                type: 'scatter',
                mode: 'lines'
            }], {
                xaxis: { title: '距離 (km)' },
                yaxis: { title: '標高 (m)' }
            });

            // マーカーの初期化
            var marker = L.marker([latlngs[0][0], latlngs[0][1]]).addTo(map);

            // スライダーの設定
            var slider = document.getElementById('slider');
            slider.max = latlngs.length - 1;

            // マーカーとビューを更新する共通関数
            function updateMarkerAndView(idx) {
                var latlng = latlngs[idx];
                marker.setLatLng([latlng[0], latlng[1]]);
                map.setView([latlng[0], latlng[1]], 15);
                Plotly.Fx.hover('graph', [{
                    curveNumber: 0,
                    pointNumber: idx
                }]);
            }

            slider.addEventListener('input', function() {
                var idx = slider.value;
                updateMarkerAndView(idx);
            });

            // グラフのホバーイベント
            graphDiv.on('plotly_hover', function(eventdata) {
                var idx = eventdata.points[0].pointNumber;
                slider.value = idx;
                updateMarkerAndView(idx);
            });

            // グラフのクリックイベント
            graphDiv.on('plotly_click', function(eventdata) {
                var idx = eventdata.points[0].pointNumber;
                slider.value = idx;
                updateMarkerAndView(idx);
            });

            // 初期距離表示更新
            updateMarkerAndView(0);
        });
    </script>
</body>
</html>
